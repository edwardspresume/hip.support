---
import { changeLanguage, t } from "i18next";
import Form from "../../components/Form.astro";
import BaseLayout, { Props as PageInfo } from "../../layouts/BaseLayout.astro";

changeLanguage("ht");

const pageInfo: PageInfo = {
    current_page: "volunteer_page",
    metaTitle: "Volunteer | HIP - HAITI IMMIGRATION PROJECT",
    metaDescription: "Volunteer with the haiti immigration project to help the cause",
};
---

<BaseLayout {...pageInfo}>
    <main>
        <section>
            <div class='container'>
                <h1>
                    {t('form:volunteer_heading')}
                </h1>

                <Form page={pageInfo.current_page} form_name='Volunteer'>
                    <label>
                        <span class='label_text'>
                            {t('form:labels.skills')} *</span
                        >
                        <input
                            class='form_input'
                            type='text'
                            name='skills'
                            minlength='3'
                            required
                        />
                    </label>

                    <label>
                        <span class='label_text'>
                            {t('form:labels.resume')} *</span
                        >
                        <input
                            class='file-input form_input'
                            type='file'
                            name='resume'
                            accept='.pdf, .doc, .docx, .txt'
                            required
                        />
                    </label>
                </Form>
            </div>
        </section>
    </main>
</BaseLayout>

<script>
    const form = document.querySelector('form') as HTMLFormElement;
    const htmlTag = document.querySelector('html') as HTMLHtmlElement;
    const currentLanguage = htmlTag.getAttribute('lang');
    const MAX_SIZE = 6 * 1000 * 1000; // 6MB limit

    const alertMessage =
        currentLanguage === 'en'
            ? 'File size is too big! It needs to be 6MB or less, try reducing the file and resubmit.'
            : 'Gwosè dosye a twò gwo! Li bezwen 6MB oswa mwens, eseye diminye fichye a epi soumèt ankò';

    form.addEventListener('submit', (event: SubmitEvent) => {
        const formData = new FormData(form);
        const file = formData.get('resume');

        if (file instanceof File && file.size > MAX_SIZE) {
            event.preventDefault();
            alert(alertMessage);
        }
    });
</script>
